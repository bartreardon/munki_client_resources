<!--
Let one display banners, conditional if certain items are visible, or alternatly remove them
To do this it does a simple parse of the current view and if the app you want is present then it displays the banner.

this script uses json that looks something like this
Could be a static file or could be generated from a database - change to whatever you need.

[
    {
        "appName": "FooApp",
        "appBannerImage": "static/branding_test.png",
        "appBannerLink": "#",
        "appAction": "add|remove"
    }
]


-->

<script type="text/javascript">
// place in footer_template.html
function getJson(url) {
	var request = new XMLHttpRequest();
	var jsonArray = [];
	
	request.open('GET', url, false);
	request.send(null);
	if (request.status === 200) {
		jsonArray = JSON.parse(request.responseText);
	}
	return jsonArray;
}

var displayedAppList = document.getElementsByClassName('name');
var appsToCheck = getJson('http://127.0.0.1/munki_repo/bannertest.json') //replace with your json link
// not sure which order is more efficient, loops probably need to be reversed.
for (var i = 0; i < displayedAppList.length; i++) {
	for (var p = 0; p < appsToCheck.length; p++) {
	    if (displayedAppList[i].innerHTML.indexOf(appsToCheck[p].appName) > -1){
	    	var bannerDiv = document.getElementsByClassName('stage');
	    	if (appsToCheck[p].appAction == "add") {
				var extraContent = "<img href=\"" + appsToCheck[p].appBannerLink + "\" alt=\"Branding\" src=\"" + appsToCheck[p].appBannerImage + "\" />";
				bannerDiv[0].innerHTML = bannerDiv[0].innerHTML + extraContent;
			} else if (appsToCheck[p].appAction == "remove") {
				for (n=0; n<bannerDiv[0].children.length; n++) {
					if (bannerDiv[0].children[n].src.indexOf(appsToCheck[p].appBannerImage) > -1) {
						bannerDiv[0].removeChild(bannerDiv[0].children[n]);
					}
				}
			}
	    }
	}
}
</script>
